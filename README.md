# Marzban Central Manager - Professional Edition v3.0

<p align="center">
  <strong>🚀 ابزار حرفه‌ای و پیشرفته برای مدیریت متمرکز، پشتیبان‌گیری هوشمند و مانیتورینگ پیشرفته شبکه‌ای از سرورهای مرزبان</strong>
  <br />
  <br />
  <img src="https://img.shields.io/badge/Version-Professional%203.0-blue?style=for-the-badge" alt="Version">
  <img src="https://img.shields.io/badge/Status-Production%20Ready-green?style=for-the-badge" alt="Status">
  <img src="https://img.shields.io/badge/License-Open%20Source-orange?style=for-the-badge" alt="License">
</p>

---

## 🌟 نسخه Professional Edition v3.0 - ویژگی‌های جدید

### 🔥 **تازه‌ترین بهبودها:**
- **🛡️ سیستم امنیتی پیشرفته** با مدیریت Lock و جلوگیری از اجرای همزمان
- **🎨 رابط کاربری کامل بازطراحی شده** با آیکون‌ها و رنگ‌بندی حرفه‌ای
- **📊 سیستم مانیتورینگ بهینه شده** با کاهش بار سرور و افزایش دقت
- **🔄 سیستم Rollback پیشرفته** برای بازگشت خودکار در صورت خطا
- **🌍 تشخیص هوشمند فایل‌های Geo** با اسکن چندمرحله‌ای
- **📱 سیستم اطلاع‌رسانی تلگرام پیشرفته** با سطوح مختلف اولویت
- **🔧 ابزارهای مدیریت Nginx** برای کنترل کامل وب‌سرور

## 🚀 چرا Marzban Central Manager Professional؟

مدیریت همزمان چندین سرور مرزبان (Node) در سطح حرفه‌ای نیازمند ابزاری قدرتمند، قابل اعتماد و هوشمند است. **Marzban Central Manager Professional Edition** فراتر از یک اسکریپت ساده، یک **پلتفرم مدیریتی کامل** است که تمام جنبه‌های مدیریت زیرساخت مرزبان را پوشش می‌دهد.

### 💡 **مزایای کلیدی:**
- **🎯 مدیریت متمرکز** تمام نودها از یک نقطه واحد
- **🤖 اتوماسیون کامل** فرآیندهای تکراری و حیاتی
- **🛡️ امنیت پیشرفته** با رمزگذاری و مدیریت دسترسی
- **📈 مانیتورینگ مداوم** با هشدارهای هوشمند
- **💾 پشتیبان‌گیری حرفه‌ای** با سیاست‌های retention
- **🔄 بازیابی خودکار** در صورت بروز مشکل

## ✨ قابلیت‌های کلیدی Professional Edition

### 🖥️ **مدیریت نودها**
- **افزودن نود جدید:** نصب و پیکربندی کامل خودکار
- **وارد کردن نودهای موجود:** از طریق CSV، تشخیص خودکار یا تک‌به‌تک
- **ویرایش پیکربندی:** تغییر اطلاعات SSH، دامنه و سایر تنظیمات
- **حذف ایمن نود:** با پاک‌سازی کامل از پنل و HAProxy

### 💾 **سیستم پشتیبان‌گیری پیشرفته**
- **بکاپ کامل سیستم:** شامل سرور اصلی + تمام نودها
- **بکاپ انتخابی:** فقط سرور اصلی یا فقط نودها
- **زمان‌بندی خودکار:** بکاپ روزانه در ساعت 3:30 صبح (قابل تنظیم)
- **سیاست Retention:** نگهداری خودکار 3 بکاپ آخر
- **فشرده‌سازی هوشمند:** استفاده از pigz برای سرعت بالا
- **تأیید یکپارچگی:** بررسی خودکار سلامت فایل های بکاپ

### 🔄 **همگام‌سازی پیشرفته**
- **HAProxy Sync:** همگام‌سازی کانفیگ در تمام نودها با Rollback
- **فایل‌های Geo:** انتقال geoip.dat و geosite.dat
- **گواهی‌های SSL:** به‌روزرسانی خودکار client certificates
- **مانیتورینگ تطابق:** بررسی مداوم همگامی کانفیگ‌ها

### 📡 **مانیتورینگ و اطلاع‌رسانی**
- **بررسی سلامت نودها:** وضعیت آنلاین/آفلاین از طریق API
- **مانیتورینگ همگامی:** تشخیص نودهای out-of-sync
- **Auto-Resync:** همگام‌سازی مجدد خودکار
- **نوتیفیکیشن تلگرام:** 4 سطح اولویت (همه، مهم، بحرانی، خاموش)
- **گزارش‌های دوره‌ای:** وضعیت کلی سیستم

### 🔧 **ابزارهای مدیریتی**
- **مدیریت Nginx:** مشاهده، تست، reload و restart
- **مدیریت گواهی SSL:** تولید، تمدید و بررسی وضعیت
- **عملیات گروهی:** restart، update certificates، update geo files
- **پاک‌سازی سیستم:** حذف لاگ‌های قدیمی و فایل‌های اضافی

### 🛡️ **امنیت و پایداری**
- **Lock Management:** جلوگیری از اجرای همزمان
- **Retry Mechanism:** تلاش مجدد خودکار در صورت خطا
- **Rate Limiting:** کنترل بار API و SSH
- **Masked Logging:** مخفی‌سازی اطلاعات حساس در لاگ‌ها
- **Error Handling:** مدیریت پیشرفته خطاها با بازگشت ایمن

## 🎯 **ویژگی‌های تشخیصی پیشرفته**

### 🔍 **تشخیص خودکار سرویس‌ها**
- **Nginx Detection:** تشخیص و مدیریت خودکار
- **HAProxy Detection:** شناسایی و همگام‌سازی
- **Geo Files Detection:** اسکن چندمرحله‌ای هوشمند:
  1. خواندن از فایل .env
  2. تجزیه xray_config.json
  3. جستجو در مسیرهای معمول

### 📊 **مانیتورینگ منابع**
- **CPU Usage:** نمایش زنده مصرف پردازنده
- **Memory Usage:** وضعیت RAM و Swap
- **Disk Usage:** فضای باقی‌مانده دیسک
- **Network Status:** وضعیت اتصالات شبکه
- **Service Status:** وضعیت Docker، Nginx، HAProxy

## 🔧 **نصب و راه‌اندازی**

### پیش‌نیازها
- سرور Ubuntu/Debian با دسترسی root
- اتصال اینترنت پایدار
- دسترسی SSH به نودهای مقصد

### مراحل نصب

۱. **کلون پروژه:**
```bash
git clone https://github.com/behnamrjd/MarzbanCentralManager.git
cd MarzbanCentralManager/MarzbanManager
```

۲. **اجرا:**
```bash
./marzban_central_manager.sh
```

۳. **تنظیمات اولیه:**
- پیکربندی API مرزبان
- تنظیم اطلاع‌رسانی تلگرام (اختیاری)
- افزودن نودهای اول

## 📱 **تنظیم اطلاع‌رسانی تلگرام**

برای دریافت نوتیفیکیشن‌های سیستم:

۱. **ایجاد ربات تلگرام:**
   - به @BotFather مراجعه کنید
   - دستور `/newbot` را ارسال کنید
   - Token دریافتی را یادداشت کنید

۲. **دریافت Chat ID:**
   - به ربات خود پیام دهید
   - به `https://api.telegram.org/bot<TOKEN>/getUpdates` مراجعه کنید
   - Chat ID را از پاسخ استخراج کنید

۳. **تنظیم در سیستم:**
   - از منوی اصلی گزینه "Configure Telegram Notifications" را انتخاب کنید
   - Token و Chat ID را وارد کنید
   - سطح اطلاع‌رسانی مورد نظر را انتخاب کنید

## 🔒 **امنیت و حریم خصوصی**

### نکات مهم امنیتی:
- **ذخیره‌سازی محلی:** تمام اطلاعات فقط روی سرور شما نگهداری می‌شود
- **عدم انتقال داده:** هیچ اطلاعاتی به سرورهای خارجی ارسال نمی‌شود
- **کد متن‌باز:** امکان بررسی کامل کد توسط شما
- **رمزگذاری SSH:** استفاده از پروتکل‌های امن برای ارتباط

### توصیه‌های امنیتی:
- سرور مرکزی را به‌خوبی امن کنید
- از کلیدهای SSH به جای پسورد استفاده کنید
- دسترسی‌های غیرضروری را محدود کنید
- بکاپ‌های منظم از تنظیمات بگیرید

## 📋 **مثال‌های کاربردی**

### سناریو 1: افزودن نود جدید
```
1. انتخاب "Add New Node" از منوی اصلی
2. وارد کردن اطلاعات نود (IP، SSH، دامنه)
3. انتخاب نصب خودکار یا وارد کردن نود موجود
4. تأیید و اتمام فرآیند
```

### سناریو 2: بکاپ اضطراری
```
1. انتخاب "Backup & Restore System"
2. انتخاب "Create Full System Backup"
3. تأیید شامل شدن Nginx/HAProxy
4. انتظار برای تکمیل و دریافت نوتیفیکیشن
```

### سناریو 3: رفع مشکل همگامی
```
1. سیستم خودکار نودهای out-of-sync را تشخیص می‌دهد
2. نوتیفیکیشن تلگرام ارسال می‌شود
3. Auto-resync خودکار شروع می‌شود
4. در صورت شکست، Rollback انجام می‌شود
```

## 🔧 **عیب‌یابی رایج**

### مشکل: نود آفلاین نشان داده می‌شود
**راه‌حل:**
- بررسی اتصال شبکه نود
- کنترل وضعیت سرویس Docker
- بررسی گواهی‌های SSL

### مشکل: خطا در همگام‌سازی HAProxy
**راه‌حل:**
- بررسی syntax کانفیگ HAProxy
- کنترل دسترسی‌های فایل
- استفاده از گزینه Rollback

### مشکل: بکاپ ناتمام
**راه‌حل:**
- بررسی فضای دیسک
- کنترل دسترسی‌های SSH
- مشاهده لاگ‌های سیستم

## 🚀 **نقشه راه آینده**

### نسخه‌های آتی:
- **🌐 رابط وب:** پنل مدیریتی تحت وب
- **📊 داشبورد آماری:** نمودارهای مصرف و ترافیک
- **🔄 Load Balancing:** توزیع هوشمند بار
- **🛡️ Security Hardening:** تقویت امنیت خودکار
- **📱 اپلیکیشن موبایل:** مدیریت از طریق گوشی

## 🤝 **مشارکت و پشتیبانی**

### نحوه مشارکت:
1. **Fork** کردن پروژه
2. ایجاد **branch** جدید برای ویژگی
3. **Commit** تغییرات با توضیحات واضح
4. ارسال **Pull Request**

### گزارش مشکلات:
- از بخش **Issues** در GitHub استفاده کنید
- توضیح کامل مشکل و مراحل بازتولید
- ارائه لاگ‌های مربوطه

### پشتیبانی:
- **GitHub Issues:** برای مشکلات فنی
- **Discussions:** برای سوالات عمومی
- **Email:** برای موارد خاص


## 📜 **مجوز و شرایط استفاده**

این پروژه تحت مجوز **MIT** منتشر شده است. شما آزاد هستید که:
- از آن برای اهداف شخصی و تجاری استفاده کنید
- کد را تغییر دهید و بهبود ببخشید
- آن را توزیع کنید
- مشارکت کنید و به جامعه کمک کنید

### قدردانی:
- **تیم Marzban:** برای ایجاد پلتفرم فوق‌العاده مرزبان


---

<p align="center">
  <a href="https://github.com/behnamrjd/MarzbanCentralManager/stargazers"><img src="https://img.shields.io/github/stars/behnamrjd/MarzbanCentralManager?style=social" alt="Stars"></a>
  <a href="https://github.com/behnamrjd/MarzbanCentralManager/issues"><img src="https://img.shields.io/github/issues/behnamrjd/MarzbanCentralManager" alt="Issues"></a>
  <a href="https://github.com/behnamrjd/MarzbanCentralManager/network/members"><img src="https://img.shields.io/github/forks/behnamrjd/MarzbanCentralManager?style=social" alt="Forks"></a>
  <br />
  <br />
  <strong>🌟 اگر این پروژه برایتان مفید بود، لطفاً یک ستاره بدهید! 🌟</strong>
  <br />
  <em>Made with ❤️ by B3hnamR</em>
  <br />
  <em>Special Thanks to Marzban Development Team & Open Source Community</em>
</p>

---

## 📞 **تماس و ارتباط**

<p align="center">
  <a href="https://github.com/B3hnamR"><img src="https://img.shields.io/badge/GitHub-B3hnamR-black?style=flat-square&logo=github" alt="GitHub"></a>
  <a href="mailto:behnamrjd@gmail.com"><img src="https://img.shields.io/badge/Email-behnamrjd@gmail.com-red?style=flat-square&logo=gmail" alt="Email"></a>
</p>
