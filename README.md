# Marzban Central Manager

<p align="center">
  یک ابزار قدرتمند و حرفه‌ای برای مدیریت متمرکز، پشتیبان‌گیری، مانیتورینگ و همگام‌سازی شبکه‌ای از سرورهای مرزبان (Marzban Nodes)

---

## 🚀 معرفی پروژه

مدیریت چندین سرور مرزبان (Node) به صورت مجزا می‌تواند کاری زمان‌بر و پیچیده باشد. **Marzban Central Manager** این مشکل را با فراهم کردن یک پنل مدیریتی متمرکز مبتنی بر ترمینال حل می‌کند. با این اسکریپت می‌توانید تمام نودهای خود را از یک نقطه مدیریت کنید، به صورت خودکار از آن‌ها بکاپ بگیرید، کانفیگ‌ها را همگام‌سازی کنید و وضعیت سلامت آن‌ها را به طور مداوم زیر نظر داشته باشید.

این پروژه برای مدیران سرور طراحی شده است که به دنبال اتوماسیون، پایداری و سهولت در مدیریت زیرساخت مرزبان خود هستند.

## ✨ قابلیت‌های کلیدی

-   **🖥️ مدیریت متمرکز نودها:** افزودن، حذف و ویرایش نودها از طریق یک منوی تعاملی.
-   **💾 سیستم پشتیبان‌گیری جامع:**
    -   بکاپ کامل از سرور اصلی (شامل Marzban, Nginx, HAProxy) و تمام نودها.
    -   زمان‌بندی خودکار بکاپ‌های روزانه با قابلیت تنظیم ساعت.
    -   سیاست نگهداری بکاپ (Retention Policy) برای مدیریت فضای ذخیره‌سازی.
-   **🔄 همگام‌سازی پیشرفته:**
    -   همگام‌سازی خودکار کانفیگ **HAProxy** در تمام نودها با قابلیت بازگشت (Rollback) در صورت بروز خطا.
    -   همگام‌سازی فایل‌های **GeoIP و Geosite** برای یکپارچگی قوانین مسیریابی.
    -   انتقال کاربران بین نودها.
-   **🔧 نصب و راه‌اندازی خودکار (Automated Deployment):**
    -   نصب و پیکربندی کامل یک سرور جدید به عنوان Marzban-Node تنها با یک دستور.
-   **📡 مانیتورینگ و اطلاع‌رسانی:**
    -   بررسی مداوم وضعیت سلامت (Online/Offline) و تطابق کانفیگ نودها.
    -   همگام‌سازی مجدد خودکار (Auto-Resync) در صورت شناسایی عدم تطابق.
    -   ارسال **نوتیفیکیشن تلگرام** برای رویدادهای مهم (بکاپ، خطاها، وضعیت نودها).
-   **⚙️ ابزارهای تشخیصی (Diagnostics):**
    -   نمایش زنده منابع سیستم (CPU, RAM, Disk).
    -   تست اتصال شبکه و وضعیت سرویس‌های کلیدی.
    -   مشاهده لاگ‌های سیستم به صورت دسته‌بندی شده.
-   **🤖 رابط کاربری هوشمند:**
    -   منوی کاملاً تعاملی و کاربرپسند.
    -   نصب خودکار پیش‌نیازهای مورد نیاز.
    -   لاگ‌گیری پیشرفته و رنگی برای خوانایی بهتر.

##  معماری

این پروژه از دو جزء اصلی تشکیل شده است:
1.  **`marzban_central_manager.sh`**: اسکریپت اصلی که روی سرور مرکزی شما اجرا شده و به عنوان پنل کنترل عمل می‌کند.
2.  **`marzban_node_deployer.sh`**: یک اسکریپت کمکی که برای آماده‌سازی و نصب مرزبان روی سرورهای جدید (نودها) استفاده می‌شود.

## 📋 پیش‌نیازها

-   یک سرور مرکزی (ترجیحاً Debian/Ubuntu) برای اجرای اسکریپت مدیریت.
-   یک یا چند سرور برای استفاده به عنوان نود.
-   دسترسی `root` به سرورها.
-   پیش‌نیازهایی مانند `curl`, `jq`, `sshpass` و `rsync` که اسکریپت به صورت خودکار تلاش به نصب آن‌ها می‌کند.

## ⚙️ نصب و راه‌اندازی

۱. ابتدا پروژه را از گیت‌هاب کلون کنید:
```
git clone https://github.com/behnamrjd/MarzbanCentralManager.git
```

۲. وارد پوشه پروژه شده و اسکریپت اصلی را اجرا کنید:
```
cd MarzbanCentralManager/MarzbanManager
chmod +x marzban_central_manager.sh
./marzban_central_manager.sh
```
در اولین اجرا، اسکریپت شما را برای انجام تنظیمات اولیه راهنمایی می‌کند.

## 💡 نحوه استفاده

پس از اجرای اسکریپت، منوی اصلی نمایش داده می‌شود که از طریق آن می‌توانید به تمام قابلیت‌ها دسترسی داشته باشید. گزینه‌ها به صورت واضح دسته‌بندی شده‌اند:

-   **مدیریت نودها:** برای افزودن یا حذف سرورهای خود.
-   **همگام‌سازی:** برای یکسان‌سازی کاربران یا کانفیگ‌ها.
-   **بکاپ و بازیابی:** برای مدیریت پشتیبان‌گیری.
-   **ابزارهای تشخیصی:** برای بررسی وضعیت سیستم و شبکه.

## 📄 فایل‌های کانفیگ

تنظیمات اصلی و لیست نودها در فایل‌های زیر در مسیر `/root/MarzbanManager` ذخیره می‌شوند:

-   `marzban_manager.conf`: تنظیمات اصلی اسکریپت (مانند توکن تلگرام).
-   `marzban_managed_nodes.conf`: لیست و اطلاعات نودهای مدیریت‌شده.

## 🤝 مشارکت

از مشارکت شما در این پروژه استقبال می‌شود. برای بهبود پروژه می‌توانید Pull Request ارسال کرده یا Issue ثبت کنید.

## 📜 مجوز و شرایط استفاده

این اسکریپت را برای استفاده شخصی و کمک به جامعه مرزبان نوشتم. با خیال راحت از آن استفاده کنید. اگر برایتان مفید بود، یک ستاره ⭐ در گیت‌هاب باعث دلگرمی است.

```
