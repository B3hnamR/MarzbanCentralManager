# Marzban Central Manager - Modular Architecture v3.1

## ๐๏ธ ุณุงุฎุชุงุฑ ูุงฺููุงุฑ ุฌุฏุฏ

ุงู ูพุฑูฺู ุจู ุณุงุฎุชุงุฑ ูุงฺููุงุฑ ุญุฑููโุง ุจุงุฒุทุฑุงุญ ุดุฏู ุงุณุช ุชุง ูฺฏูุฏุงุฑุ ุชูุณุนู ู ุฏุจุงฺฏ ุขู ุขุณุงูโุชุฑ ุจุงุดุฏ.

## ๐ ุณุงุฎุชุงุฑ ุฏุงุฑฺฉุชูุฑ

```
MarzbanManager/
โโโ marzban_central_manager_new.sh    # ูุงู ุงุตู ุฌุฏุฏ (ูุงฺููุงุฑ)
โโโ marzban_central_manager.sh        # ูุงู ูุฏู (ุจุฑุง ููุงุณู)
โโโ marzban_node_deployer_fixed.sh    # ุงุณฺฉุฑูพุช ูุตุจ ููุฏ
โโโ migrate_to_modular.sh             # ุงุณฺฉุฑูพุช ููุงุฌุฑุช
โโโ MODULAR_ARCHITECTURE.md           # ุงู ูุงู
โโโ lib/                               # ฺฉุชุงุจุฎุงูู ูุงฺููโูุง
    โโโ core/                          # ูุงฺููโูุง ูุณุชู
    โ   โโโ config.sh                  # ูุฏุฑุช ูพฺฉุฑุจูุฏ
    โ   โโโ logger.sh                  # ุณุณุชู ูุงฺฏ
    โ   โโโ utils.sh                   # ุชูุงุจุน ฺฉูฺฉ
    โ   โโโ dependencies.sh            # ูุฏุฑุช ูุงุจุณุชฺฏโูุง
    โโโ api/                           # ูุงฺููโูุง API
    โ   โโโ marzban_api.sh            # API ูุฑุฒุจุงู
    โ   โโโ telegram_api.sh           # API ุชูฺฏุฑุงู
    โโโ nodes/                         # ูุฏุฑุช ููุฏูุง
    โ   โโโ node_manager.sh           # ูุฏุฑุช ููุฏูุง
    โ   โโโ ssh_operations.sh         # ุนููุงุช SSH
    โโโ backup/                        # ุณุณุชู ุจฺฉุงูพ
    โ   โโโ backup_manager.sh         # ูุฏุฑุช ุจฺฉุงูพ
    โโโ sync/                          # ููฺฏุงูโุณุงุฒ (ุขูุฏู)
    โ   โโโ sync_manager.sh           # ูุฏุฑุช ููฺฏุงูโุณุงุฒ
    โโโ monitoring/                    # ูุงูุชูุฑูฺฏ (ุขูุฏู)
        โโโ monitor_manager.sh        # ูุฏุฑุช ูุงูุชูุฑูฺฏ
```

## ๐งฉ ูุงฺููโูุง ุงุตู

### 1. Core Modules (ูุงฺููโูุง ูุณุชู)

#### `config.sh` - ูุฏุฑุช ูพฺฉุฑุจูุฏ
- ูุฏุฑุช ูุชุบุฑูุง ุณุฑุงุณุฑ
- ุจุงุฑฺฏุฐุงุฑ ู ุฐุฎุฑู ุชูุธูุงุช
- ุงุนุชุจุงุฑุณูุฌ ูพฺฉุฑุจูุฏ
- ูุฏุฑุช ุฏุงุฑฺฉุชูุฑโูุง

#### `logger.sh` - ุณุณุชู ูุงฺฏ
- ุณ๏ฟฝ๏ฟฝุชู ูุงฺฏ ุฑูฺฏ ู ุฒูุงูโุฏุงุฑ
- ุณุทูุญ ูุฎุชูู ูุงฺฏ (DEBUG, INFO, WARNING, ERROR, SUCCESS)
- ูุฎูโุณุงุฒ ุงุทูุงุนุงุช ุญุณุงุณ
- ฺุฑุฎุด ูุงูโูุง ูุงฺฏ

#### `utils.sh` - ุชูุงุจุน ฺฉูฺฉ
- ุชูุงุจุน ุณุณุชู
- ุงุนุชุจุงุฑุณูุฌ ูุฑูุฏโูุง
- ุนููุงุช ูุงู
- ูุฏุฑุช ูุฑุขูุฏูุง

#### `dependencies.sh` - ูุฏุฑุช ูุงุจุณุชฺฏโูุง
- ุจุฑุฑุณ ูุงุจุณุชฺฏโูุง
- ูุตุจ ุฎูุฏฺฉุงุฑ ุจุณุชูโูุง
- ูุฏุฑุช ูุณุฎูโูุง

### 2. API Modules (ูุงฺููโูุง API)

#### `marzban_api.sh` - API ูุฑุฒุจุงู
- ุงุญุฑุงุฒ ููุช ู ูุฏุฑุช ุชูฺฉู
- ุนููุงุช ููุฏ (ุงูุฒูุฏูุ ุญุฐูุ ุจุฑูุฒุฑุณุงู)
- ูุฏุฑุช ฺฉุงุฑุจุฑุงู
- ุฏุฑุงูุช ุขูุงุฑ ุณุณุชู

#### `telegram_api.sh` - API ุชูฺฏุฑุงู
- ุงุฑุณุงู ูพุงูโูุง
- ูุฏุฑุช ุณุทูุญ ุงุทูุงุนโุฑุณุงู
- ูุงูุจโุจูุฏ ูพุงูโูุง
- ูุฏุฑุช ุฎุทุงูุง

### 3. Node Management (ูุฏุฑุช ููุฏูุง)

#### `node_manager.sh` - ูุฏุฑุช ููุฏูุง
- ุงูุฒูุฏู ู ุญุฐู ููุฏูุง
- ุจุฑูุฒุฑุณุงู ูพฺฉุฑุจูุฏ
- ูุงูุชูุฑูฺฏ ุณูุงูุช
- ูุฏุฑุช ฺฏูุงูโูุง

#### `ssh_operations.sh` - ุนููุงุช SSH
- ุงุชุตุงู SSH ุจุง retry
- ุงูุชูุงู ูุงู (SCP/Rsync)
- ุนููุงุช ุฏุณุชูโุง
- ูุฏุฑุช ฺฉูุฏูุง SSH

### 4. Backup System (ุณุณุชู ุจฺฉุงูพ)

#### `backup_manager.sh` - ูุฏุฑุช ุจฺฉุงูพ
- ุจฺฉุงูพ ฺฉุงูู ุณุณุชู
- ุจฺฉุงูพ ุงูุชุฎุงุจ
- ูุดุฑุฏูโุณุงุฒ ููุดููุฏ
- ุณุงุณุช ูฺฏูุฏุงุฑ
- ุจฺฉุงูพ ุฎูุฏฺฉุงุฑ

## ๐ง ูุฒุงุง ุณุงุฎุชุงุฑ ูุงฺููุงุฑ

### 1. **ูุงุจูุช ูฺฏูุฏุงุฑ ุจุงูุง**
- ูุฑ ูุงฺูู ูุณุฆููุช ูุดุฎุต ุฏุงุฑุฏ
- ฺฉุฏ ุชูุฒ ู ุณุงุฒูุงูุฏู ุดุฏู
- ุขุณุงูโุชุฑ ุจุฑุง ุฏุจุงฺฏ

### 2. **ูุงุจูุช ุชูุณุนู**
- ุงูุฒูุฏู ูฺฺฏ ุฌุฏุฏ ุจุฏูู ุชุบุฑ ฺฉุฏ ููุฌูุฏ
- ูุงฺููโูุง ูุณุชูู
- ุงูฺฉุงู ุชุณุช ุฌุฏุงฺฏุงูู

### 3. **ุงุณุชูุงุฏู ูุฌุฏุฏ**
- ูุงฺููโูุง ูุงุจู ุงุณุชูุงุฏู ุฏุฑ ูพุฑูฺูโูุง ุฏฺฏุฑ
- API ฺฉูพุงุฑฺู
- ูุณุชูุฏุณุงุฒ ุจูุชุฑ

### 4. **ูุฏุฑุช ุฎุทุง ุจูุชุฑ**
- ุฎุทุงูุง ุฏุฑ ุณุทุญ ูุงฺูู ูุฏุฑุช ูโุดููุฏ
- ูุงฺฏโฺฏุฑ ุฏููโุชุฑ
- ุจุงุฒุงุจ ุขุณุงูโุชุฑ

## ๐ ูุญูู ุงุณุชูุงุฏู

### ุงุฌุฑุง ูุงู ุฌุฏุฏ:
```bash
# ุงุฌุฑุง ุญุงูุช ุช๏ฟฝ๏ฟฝุงูู
./marzban_central_manager_new.sh

# ุงุฌุฑุง ุฏุณุชูุฑุงุช ุฎุงุต
./marzban_central_manager_new.sh --backup-full
./marzban_central_manager_new.sh --monitor-health
./marzban_central_manager_new.sh --update-certificates
```

### ุจุงุฑฺฏุฐุงุฑ ูุงฺููโูุง ุฏุฑ ุงุณฺฉุฑูพุชโูุง ุฏฺฏุฑ:
```bash
# ุจุงุฑฺฏุฐุงุฑ ูุงฺูู ุฎุงุต
source lib/core/logger.sh
source lib/api/marzban_api.sh

# ุงุณุชูุงุฏู ุงุฒ ุชูุงุจุน
log_info "This is a test message"
get_marzban_token
```

## ๐ ููุงุฌุฑุช ุงุฒ ูุณุฎู ูุฏู

### 1. **ุชุณุช ูุณุฎู ุฌุฏุฏ**
```bash
# ุชุณุช ุนููฺฉุฑุฏ
./marzban_central_manager_new.sh --dependency-check
./marzban_central_manager_new.sh --version
```

### 2. **ุงูุชูุงู ุชูุธูุงุช**
ุชูุธูุงุช ููุฌูุฏ ุจู ุทูุฑ ุฎูุฏฺฉุงุฑ ุจุงุฑฺฏุฐุงุฑ ูโุดููุฏ.

### 3. **ุฌุงฺฏุฒู ูุงู ุงุตู**
```bash
# ูพุดุชุจุงูโฺฏุฑ ุงุฒ ูุงู ูุฏู
cp marzban_central_manager.sh marzban_central_manager_old.sh

# ุฌุงฺฏุฒู
mv marzban_central_manager_new.sh marzban_central_manager.sh
chmod +x marzban_central_manager.sh
```

## ๐๏ธ ุชูุณุนู ู ุณูุงุฑุดโุณุงุฒ

### ุงูุฒูุฏู ูุงฺูู ุฌุฏุฏ:

1. **ุงุฌุงุฏ ูุงู ูุงฺูู:**
```bash
# ูุซุงู: ูุงฺูู ูุฏุฑุช SSL
touch lib/ssl/ssl_manager.sh
```

2. **ุณุงุฎุชุงุฑ ูุงฺูู:**
```bash
#!/bin/bash
# SSL Management Module
# Professional Edition v3.1
# Author: B3hnamR

# ุชูุงุจุน ุนููู
init_ssl_manager() {
    log_debug "SSL manager initialized"
    return 0
}

# ุชูุงุจุน ุงุฎุชุตุงุต
generate_ssl_certificate() {
    # ฺฉุฏ ุชููุฏ ฺฏูุงู
}
```

3. **ุงุถุงูู ฺฉุฑุฏู ุจู ูุงู ุงุตู:**
```bash
# ุฏุฑ ุชุงุจุน load_all_modules
local ssl_modules=(
    "$LIB_DIR/ssl/ssl_manager.sh"
)
```

### ุณูุงุฑุดโุณุงุฒ ูุงฺฏ:
```bash
# ุชุบุฑ ุณุทุญ ูุงฺฏ
set_log_level "DEBUG"

# ูุงฺฏ ุณูุงุฑุด
log_custom() {
    local message="$1"
    echo -e "[$(date '+%H:%M:%S')] ๐ง CUSTOM: $message"
}
```

## ๐ TODO ู ูฺฺฏโูุง ุขูุฏู

### ูุงฺููโูุง ุฏุฑ ุญุงู ุชูุณุนู:
- [ ] `sync_manager.sh` - ููฺฏุงูโุณุงุฒ ูพุดุฑูุชู
- [ ] `monitor_manager.sh` - ูุงูุชูุฑูฺฏ ูุฏุงูู
- [ ] `ssl_manager.sh` - ูุฏุฑุช ฺฏูุงูโูุง SSL
- [ ] `nginx_manager.sh` - ูุฏุฑุช Nginx
- [ ] `haproxy_manager.sh` - ูุฏุฑุช HAProxy

### ุจูุจูุฏูุง ุจุฑูุงููโุฑุฒ ุดุฏู:
- [ ] ุฑุงุจุท ูุจ
- [ ] API RESTful
- [ ] ูพุดุชุจุงู ุงุฒ Docker Compose
- [ ] ูุงูุชูุฑูฺฏ Prometheus
- [ ] ุฏุงุดุจูุฑุฏ Grafana

## ๐ค ูุดุงุฑฺฉุช

ุจุฑุง ูุดุงุฑฺฉุช ุฏุฑ ุชูุณุนู:

1. **Fork** ฺฉุฑุฏู ูพุฑูฺู
2. ุงุฌุงุฏ **branch** ุฌุฏุฏ ุจุฑุง ูฺฺฏ
3. **Commit** ุชุบุฑุงุช ุจุง ุชูุถุญุงุช ูุงุถุญ
4. ุงุฑุณุงู **Pull Request**

### ุงุณุชุงูุฏุงุฑุฏูุง ฺฉุฏููุณ:
- ุงุณุชูุงุฏู ุงุฒ `set -euo pipefail`
- ูุงูโฺฏุฐุงุฑ ูุงุถุญ ุจุฑุง ุชูุงุจุน
- ฺฉุงููุชโฺฏุฐุงุฑ ููุงุณุจ
- ูุฏุฑุช ุฎุทุง ุฌุงูุน
- ุชุณุช ูุจู ุงุฒ commit

## ๐ ูพุดุชุจุงู

- **GitHub Issues:** ุจุฑุง ฺฏุฒุงุฑุด ูุดฺฉูุงุช
- **Discussions:** ุจุฑุง ุณูุงูุงุช ุนููู
- **Email:** behnamrjd@gmail.com

---

**ูฺฉุชู:** ุงู ุณุงุฎุชุงุฑ ูุงฺููุงุฑ ุงูฺฉุงู ุชูุณุนู ู ูฺฏูุฏุงุฑ ุขุณุงูโุชุฑ ูพุฑูฺู ุฑุง ูุฑุงูู ูโฺฉูุฏ. ูุฑ ูุงฺูู ูุณุชูู ุนูู ฺฉุฑุฏู ู ูุงุจูุช ุงุณุชูุงุฏู ูุฌุฏุฏ ุฏุงุฑุฏ.

**ูุณุฎู:** Professional Edition v3.1  
**ููุณูุฏู:** B3hnamR  
**ุชุงุฑุฎ ุจุฑูุฒุฑุณุงู:** $(date)